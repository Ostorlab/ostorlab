on:
  release:
    types: [published]


jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: ['ubuntu-latest']

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: true
    - name: Install packaging dependencies
      run: |
        sudo apt-get update -qq
        sudo apt-get install -y \
          python3 python3-dev python3-pip python3-venv python3-all \
          dh-python debhelper devscripts dput software-properties-common \
          python3-distutils python3-setuptools python3-wheel python3-stdeb
    - name: Generate .deb installer
      run: |
        pip install --upgrade setuptools setuptools_scm wheel stdeb nats-py markdownify
        rm -Rf deb_dist/*
        python3 setup.py --command-packages=stdeb.command bdist_deb -q
    - name: Release
      uses: softprops/action-gh-release@v2
      with:
        files: deb_dist/*.deb